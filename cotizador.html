<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Gestor de cotizaciones</title>
  <link rel="stylesheet" href="style.css">
  <script src="https://www.gstatic.com/firebasejs/10.12.4/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.4/firebase-auth-compat.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyAwac3okkBuOm0gB5aqRuHILefbryj9lAw",
      authDomain: "scadaweb-64eba.firebaseapp.com",
      projectId: "scadaweb-64eba",
    };
    if (!window.firebase?.apps?.length) {
      firebase.initializeApp(firebaseConfig);
    }
  </script>
  <style>
    .quote-page {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      background: radial-gradient(circle at top, rgba(58, 134, 255, 0.08), transparent 55%), var(--bg-base, #020617);
      color: var(--text-primary, #f8fafc);
    }
    .quote-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: clamp(1.5rem, 4vw, 2.5rem) clamp(1rem, 4vw, 3rem);
      gap: 1.5rem;
    }
    .quote-header__brand {
      display: flex;
      align-items: center;
      gap: 1rem;
    }
    .quote-header__brand .brand-logo {
      width: 44px;
      height: 44px;
      border-radius: 14px;
      background: rgba(9, 18, 32, 0.78);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      letter-spacing: 0.18em;
      color: #9fbaff;
      box-shadow: inset 0 0 0 1px rgba(58, 134, 255, 0.32);
    }
    .quote-header__brand h1 {
      margin: 0;
      font-size: clamp(1.4rem, 3vw, 1.8rem);
      letter-spacing: 0.08em;
    }
    .quote-header__brand p {
      margin: 0;
      color: var(--text-muted, #94a3b8);
      font-size: 0.95rem;
    }
    .quote-back {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.65rem 1.1rem;
      border-radius: 12px;
      text-decoration: none;
      color: var(--text-primary, #f8fafc);
      border: 1px solid rgba(112, 138, 255, 0.2);
      background: rgba(9, 18, 32, 0.72);
      transition: transform 0.2s ease, background 0.2s ease, border-color 0.2s ease;
    }
    .quote-back:hover {
      transform: translateX(-2px);
      background: rgba(58, 134, 255, 0.24);
      border-color: rgba(112, 138, 255, 0.35);
    }
    .quote-layout {
      width: min(1280px, 100%);
      margin: 0 auto 3.2rem;
      padding: 0 clamp(1rem, 4vw, 3rem) clamp(3rem, 6vw, 4rem);
      display: flex;
      flex-direction: column;
      gap: clamp(1.5rem, 4vw, 3.25rem);
      align-items: stretch;
    }
    .quote-pane {
      background: rgba(8, 16, 28, 0.95);
      border-radius: 22px;
      padding: clamp(1.2rem, 3vw, 2rem);
      box-shadow: 0 22px 45px rgba(2, 10, 30, 0.45);
      border: 1px solid rgba(112, 138, 255, 0.18);
      display: flex;
      flex-direction: column;
      gap: 1rem;
      position: relative;
      z-index: 1;
    }
    .quote-pane--list {
      overflow: hidden;
    }
    .quote-pane--list #quote-table-container {
      border-radius: 18px;
      overflow: hidden;
      box-shadow: inset 0 0 0 1px rgba(112, 138, 255, 0.08);
      background: rgba(12, 22, 36, 0.95);
    }
    .quote-pane--list .quote-table {
      table-layout: fixed;
    }
    .quote-pane--list .quote-table th:nth-child(1) {
      width: 28%;
    }
    .quote-pane--list .quote-table th:nth-child(2) {
      width: 28%;
    }
    .quote-pane--list .quote-table th:nth-child(3) {
      width: 18%;
    }
    .quote-pane--list .quote-table th:nth-child(4),
    .quote-pane--list .quote-table th:nth-child(5) {
      width: 13%;
    }
    .quote-pane--detail {
      z-index: 2;
    }
    .quote-pane__header {
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      gap: 1rem;
      border-bottom: 1px solid rgba(112, 138, 255, 0.12);
      padding-bottom: 0.75rem;
    }
    .quote-pane__title {
      display: flex;
      flex-direction: column;
      gap: 0.25rem;
    }
    .quote-pane__title h2 {
      margin: 0;
      font-size: 1.2rem;
      letter-spacing: 0.05em;
    }
    .quote-pane__actions {
      display: inline-flex;
      flex-wrap: wrap;
      gap: 0.6rem;
      align-items: center;
    }
    .quote-pane__actions > button {
      border-radius: 12px;
      border: 1px solid rgba(112, 138, 255, 0.3);
      padding: 0.55rem 1.05rem;
      background: rgba(58, 134, 255, 0.18);
      color: var(--text-primary, #f8fafc);
      cursor: pointer;
      transition: transform 0.15s ease, background 0.2s ease, border-color 0.2s ease;
    }
    .quote-pane__actions > button:hover {
      transform: translateY(-1px);
      background: rgba(58, 134, 255, 0.32);
      border-color: rgba(112, 138, 255, 0.45);
    }
    .helper-text {
      font-size: 0.85rem;
      color: var(--text-muted, #94a3b8);
    }
    .pane-toggle {
      background: rgba(12, 22, 36, 0.82);
      border-color: rgba(112, 138, 255, 0.2);
      font-size: 0.85rem;
      padding: 0.5rem 0.9rem;
    }
    .pane-toggle:hover {
      background: rgba(58, 134, 255, 0.24);
    }
    .quote-pane__body {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }
    [data-pane][data-collapsed="true"] .quote-pane__body {
      display: none;
    }
    [data-pane][data-collapsed="true"] .quote-pane__header {
      border-bottom-color: rgba(112, 138, 255, 0.08);
      padding-bottom: 0;
    }
    .filters-form {
      display: grid;
      gap: 0.75rem;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
    }
    .filter-field {
      display: flex;
      flex-direction: column;
      gap: 0.35rem;
    }
    .filter-field label {
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--text-muted, #94a3b8);
    }
    .filter-field input,
    .filter-field select {
      border-radius: 12px;
      border: 1px solid rgba(112, 138, 255, 0.18);
      padding: 0.6rem 0.75rem;
      background: rgba(12, 22, 36, 0.88);
      color: inherit;
      font-size: 0.9rem;
    }
    .filter-actions {
      display: flex;
      justify-content: flex-end;
      gap: 0.75rem;
    }
    .filter-actions button {
      border-radius: 12px;
      border: 1px solid rgba(112, 138, 255, 0.25);
      padding: 0.55rem 1rem;
      background: rgba(9, 18, 32, 0.9);
      color: var(--text-primary);
      cursor: pointer;
    }
    .filter-actions button[type="button"]:last-child {
      background: rgba(58, 134, 255, 0.24);
      border-color: rgba(112, 138, 255, 0.35);
    }
    .quote-table {
      width: 100%;
      border-collapse: collapse;
      border-radius: 18px;
      overflow: hidden;
      background: rgba(12, 22, 36, 0.88);
    }
    .quote-table th,
    .quote-table td {
      padding: 0.75rem 1rem;
      border-bottom: 1px solid rgba(148, 163, 184, 0.14);
      font-size: 0.9rem;
    }
    .quote-table th {
      text-align: left;
      text-transform: uppercase;
      letter-spacing: 0.06em;
      color: var(--text-muted, #94a3b8);
      font-size: 0.78rem;
    }
    .quote-row {
      cursor: pointer;
      transition: background 0.18s ease;
    }
    .quote-row:hover {
      background: rgba(58, 134, 255, 0.12);
    }
    .quote-row--selected {
      background: rgba(58, 134, 255, 0.22);
    }
    .status-pill {
      display: inline-flex;
      align-items: center;
      padding: 0.25rem 0.6rem;
      border-radius: 999px;
      font-size: 0.75rem;
      letter-spacing: 0.06em;
      text-transform: uppercase;
      background: rgba(58, 134, 255, 0.18);
      color: rgba(173, 205, 255, 0.95);
    }
    .status-pill[data-status="borrador"] { background: rgba(148, 163, 184, 0.18); color: #cbd5f5; }
    .status-pill[data-status="enviada"] { background: rgba(58, 134, 255, 0.18); }
    .status-pill[data-status="aceptada"] { background: rgba(34, 197, 94, 0.18); color: #bbf7d0; }
    .status-pill[data-status="anulada"] { background: rgba(239, 68, 68, 0.18); color: #fecaca; }
    .status-pill[data-status="expirada"] { background: rgba(234, 179, 8, 0.2); color: #fde68a; }
    .pagination {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 1rem;
      font-size: 0.85rem;
      color: var(--text-muted, #94a3b8);
    }
    .pagination button {
      border-radius: 10px;
      border: 1px solid rgba(112, 138, 255, 0.25);
      background: rgba(9, 18, 32, 0.85);
      color: var(--text-primary);
      padding: 0.5rem 0.85rem;
      cursor: pointer;
    }
    .empty-state {
      border-radius: 16px;
      border: 1px dashed rgba(112, 138, 255, 0.35);
      padding: 1rem;
      text-align: center;
      font-size: 0.9rem;
      color: var(--text-muted, #94a3b8);
    }
    .quote-detail {
      display: flex;
      flex-direction: column;
      gap: 1.1rem;
    }
    .detail-section {
      background: rgba(12, 22, 36, 0.88);
      border-radius: 18px;
      padding: 1rem 1.2rem;
      display: flex;
      flex-direction: column;
      gap: 0.85rem;
    }
    .detail-section h3 {
      margin: 0;
      font-size: 1rem;
      text-transform: uppercase;
      letter-spacing: 0.07em;
      color: rgba(148, 163, 184, 0.85);
    }
    .detail-grid {
      display: grid;
      gap: 0.85rem 1rem;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    }
    .detail-field {
      display: flex;
      flex-direction: column;
      gap: 0.4rem;
    }
    .detail-field label {
      font-size: 0.78rem;
      text-transform: uppercase;
      letter-spacing: 0.07em;
      color: var(--text-muted, #94a3b8);
    }
    .detail-field input,
    .detail-field textarea,
    .detail-field select,
    .detail-field button {
      border-radius: 12px;
      border: 1px solid rgba(112, 138, 255, 0.18);
      padding: 0.65rem 0.75rem;
      background: rgba(10, 18, 32, 0.92);
      color: inherit;
      font-size: 0.95rem;
    }
    .detail-field button {
      cursor: pointer;
      background: rgba(58, 134, 255, 0.18);
      border-color: rgba(112, 138, 255, 0.3);
    }
    .detail-field textarea {
      min-height: 90px;
      resize: vertical;
    }
    .items-table {
      width: 100%;
      border-collapse: collapse;
      border-radius: 14px;
      overflow: hidden;
      background: rgba(10, 18, 32, 0.92);
    }
    .items-table th,
    .items-table td {
      padding: 0.65rem 0.8rem;
      border-bottom: 1px solid rgba(148, 163, 184, 0.12);
      font-size: 0.85rem;
    }
    .items-table td:first-child {
      display: grid;
      gap: 0.35rem;
    }
    .items-table th {
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: rgba(148, 163, 184, 0.85);
      font-size: 0.75rem;
    }
    .items-table input,
    .items-table select {
      width: 100%;
      border-radius: 10px;
      border: 1px solid rgba(112, 138, 255, 0.2);
      background: rgba(13, 21, 36, 0.95);
      color: inherit;
      padding: 0.45rem 0.5rem;
    }
    .items-actions {
      display: flex;
      justify-content: flex-end;
    }
    .items-actions button {
      border-radius: 10px;
      border: 1px dashed rgba(112, 138, 255, 0.4);
      padding: 0.5rem 0.9rem;
      background: rgba(12, 22, 36, 0.88);
      color: rgba(173, 205, 255, 0.95);
      cursor: pointer;
    }
    .totals-grid {
      display: grid;
      gap: 0.4rem;
      font-size: 0.95rem;
    }
    .totals-grid div {
      display: flex;
      justify-content: space-between;
      color: rgba(207, 221, 255, 0.92);
    }
    .totals-grid strong {
      font-weight: 600;
    }
    .detail-actions {
      display: flex;
      flex-wrap: wrap;
      gap: 0.75rem;
      justify-content: flex-end;
    }
    .detail-actions button {
      border-radius: 12px;
      border: 1px solid rgba(112, 138, 255, 0.25);
      padding: 0.65rem 1.15rem;
      background: rgba(58, 134, 255, 0.18);
      color: var(--text-primary);
      cursor: pointer;
      transition: background 0.2s ease, border-color 0.2s ease;
    }
    .detail-actions button[disabled] {
      opacity: 0.5;
      cursor: not-allowed;
    }
    .detail-actions .danger {
      border-color: rgba(239, 68, 68, 0.35);
      background: rgba(239, 68, 68, 0.2);
    }
    .timeline {
      display: grid;
      gap: 0.6rem;
      max-height: 220px;
      overflow-y: auto;
      padding-right: 0.5rem;
    }
    .timeline-item {
      display: grid;
      gap: 0.25rem;
      background: rgba(12, 22, 36, 0.85);
      border-radius: 12px;
      padding: 0.6rem 0.75rem;
      font-size: 0.85rem;
    }
    .timeline-item .meta {
      display: flex;
      justify-content: space-between;
      color: rgba(148, 163, 184, 0.8);
      font-size: 0.75rem;
    }
    #detail-placeholder {
      margin: auto 0;
    }
  </style>
</head>
<body class="quote-page">
  <header class="quote-header">
    <div class="quote-header__brand">
      <div class="brand-logo">SN</div>
      <div>
        <h1>Cotizador comercial</h1>
        <p>Gestiona tus propuestas con historial y PDF</p>
      </div>
    </div>
    <a class="quote-back" href="index.html" aria-label="Volver al dashboard">
      &#8592; Volver al dashboard
    </a>
  </header>

  <main class="quote-layout">
    <section class="quote-pane quote-pane--list" data-pane="list" aria-label="Listado de cotizaciones">
      <div class="quote-pane__header">
        <div class="quote-pane__title">
          <h2>Cotizaciones</h2>
        </div>
        <div class="quote-pane__actions">
          <button type="button" id="new-quote-btn">Nueva cotizacion</button>
          <button type="button" class="pane-toggle" data-toggle-pane="list" aria-expanded="true">Contraer</button>
        </div>
      </div>
      <div class="quote-pane__body">
        <form id="filters-form" class="filters-form" autocomplete="off">
          <div class="filter-field">
            <label for="filter-search">Buscar</label>
            <input id="filter-search" name="search" type="search" placeholder="Cliente, folio, contacto">
          </div>
          <div class="filter-field">
            <label for="filter-status">Estado</label>
            <select id="filter-status" name="estado">
              <option value="">Todos</option>
              <option value="borrador">Borrador</option>
              <option value="enviada">Enviada</option>
              <option value="aceptada">Aceptada</option>
              <option value="anulada">Anulada</option>
              <option value="expirada">Expirada</option>
            </select>
          </div>
          <div class="filter-field">
            <label for="filter-rut">RUT</label>
            <input id="filter-rut" name="clienteRut" type="text" placeholder="11.111.111-1">
          </div>
        </form>
        <div class="filter-actions">
          <button type="button" id="clear-filters-btn">Limpiar</button>
          <button type="button" id="apply-filters-btn">Aplicar</button>
        </div>
        <div id="quote-table-container" aria-live="polite">
          <div class="empty-state" id="quote-empty-state" hidden>No hay cotizaciones registradas.</div>
          <table class="quote-table" id="quote-table">
            <thead>
              <tr>
                <th>Folio</th>
                <th>Cliente</th>
                <th>Estado</th>
                <th>Total UF</th>
                <th>Actualizado</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
        <div class="pagination" id="quote-pagination">
          <button type="button" id="prev-page-btn">&larr; Anterior</button>
          <span id="pagination-info">Pagina 1</span>
          <button type="button" id="next-page-btn">Siguiente &rarr;</button>
        </div>
      </div>
    </section>

    <section class="quote-pane quote-pane--detail" data-pane="detail" aria-live="polite">
      <div class="quote-pane__header">
        <div class="quote-pane__title">
          <h2 id="detail-title">Detalle</h2>
          <span class="helper-text" id="detail-subtitle">Selecciona una cotizacion o crea una nueva.</span>
        </div>
        <div class="quote-pane__actions">
          <button type="button" class="pane-toggle" data-toggle-pane="detail" aria-expanded="true">Contraer</button>
        </div>
      </div>
      <div class="quote-pane__body">
        <div class="empty-state" id="detail-placeholder">
          Selecciona una cotizacion del listado o usa "Nueva cotizacion".
        </div>
        <div class="quote-detail" id="quote-detail" hidden>
          <form id="quote-detail-form" autocomplete="off">
            <input type="hidden" id="quote-id">
            <div class="detail-section">
              <h3>Datos del cliente</h3>
              <div class="detail-grid">
                <div class="detail-field">
                  <label for="client-name">Nombre empresa</label>
                  <input id="client-name" name="clienteNombre" type="text" required>
                </div>
                <div class="detail-field">
                  <label for="client-rut">RUT</label>
                  <input id="client-rut" name="clienteRut" type="text" placeholder="11.111.111-1">
                </div>
                <div class="detail-field">
                  <label for="client-contact">Contacto</label>
                  <input id="client-contact" name="clienteContacto" type="text">
                </div>
                <div class="detail-field">
                  <label for="client-email">Correo</label>
                  <input id="client-email" name="clienteCorreo" type="email">
                </div>
                <div class="detail-field">
                  <label for="client-phone">Telefono</label>
                  <input id="client-phone" name="clienteTelefono" type="text">
                </div>
                <div class="detail-field">
                  <label>&nbsp;</label>
                  <div class="client-actions">
                    <button type="button" id="client-search-btn">Buscar cliente</button>
                    <button type="button" id="client-save-btn">Guardar cliente</button>
                  </div>
                </div>
              </div>
            </div>

            <div class="detail-section">
              <h3>Servicios</h3>
              <table class="items-table" id="items-table">
                <thead>
                  <tr>
                    <th>Servicio</th>
                    <th>Cant.</th>
                    <th>UF c/u</th>
                    <th>Total UF</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
              <div class="items-actions">
                <button type="button" id="add-item-btn">Agregar servicio</button>
              </div>
            </div>

            <div class="detail-section">
              <h3>Montos</h3>
              <div class="detail-grid">
                <div class="detail-field">
                  <label for="prepared-by">Preparado por</label>
                  <input id="prepared-by" name="preparedBy" type="text">
                </div>
                <div class="detail-field">
                  <label for="prepared-email">Correo responsable</label>
                  <input id="prepared-email" name="preparedEmail" type="email">
                </div>
                <div class="detail-field">
                  <label for="discount-percent">Descuento (%)</label>
                  <input id="discount-percent" name="descuentoPct" type="number" min="0" max="100" step="0.5" value="0">
                </div>
                <div class="detail-field">
                  <label for="uf-value">Valor UF (CLP)</label>
                  <input id="uf-value" name="ufValorClp" type="number" min="0" step="1">
                </div>
                <div class="detail-field">
                  <label for="validity-days">Vigencia (dias)</label>
                  <input id="validity-days" name="vigenciaDias" type="number" min="1" max="180" value="30">
                </div>
                <div class="detail-field" style="grid-column: 1 / -1;">
                  <label for="quote-notes">Observaciones</label>
                  <textarea id="quote-notes" name="observaciones" placeholder="Condiciones comerciales, notas adicionales..."></textarea>
                </div>
              </div>
              <div class="totals-grid" id="totals-grid">
                <div><span>Subtotal</span><strong id="totals-subtotal">0.00 UF</strong></div>
                <div><span>Descuento</span><strong id="totals-discount">0.00 UF</strong></div>
                <div><span>Total neto</span><strong id="totals-net">0.00 UF</strong></div>
                <div><span>IVA (19%)</span><strong id="totals-tax">0.00 UF</strong></div>
                <div><span>Total + IVA</span><strong id="totals-total">0.00 UF</strong></div>
              </div>
            </div>

            <div class="detail-actions">
              <button type="button" id="save-quote-btn">Guardar</button>
              <button type="button" id="send-quote-btn">Enviar</button>
              <button type="button" id="accept-quote-btn">Marcar aceptada</button>
              <button type="button" class="danger" id="void-quote-btn">Anular</button>
              <button type="button" id="download-quote-btn">Descargar PDF</button>
            </div>
          </form>
        </div>

        <div class="detail-section">
          <h3>Historial</h3>
          <div class="timeline" id="timeline"></div>
        </div>
      </div>
    </section>
  </main>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" defer></script>
  <script type="module" src="cotizador/main.js"></script>
</body>
</html>
